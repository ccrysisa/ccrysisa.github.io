<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>CS:APP 第 2 章重点提示和练习 - KZnight&#39;s Blog</title><meta name="author" content="ccrysisa">
<meta name="author-link" content="https://github.com/ccrysisa">
<meta name="description" content="
千万不要小看数值系统，史上不少有名的 软体缺失案例 就因为开发者未能充分掌握相关议题，而导致莫大的伤害与损失。
" /><meta name="keywords" content='Sysprog, CSAPP' /><meta itemprop="name" content="CS:APP 第 2 章重点提示和练习">
<meta itemprop="description" content="
千万不要小看数值系统，史上不少有名的 软体缺失案例 就因为开发者未能充分掌握相关议题，而导致莫大的伤害与损失。
"><meta itemprop="datePublished" content="2024-04-19T15:33:40+08:00" />
<meta itemprop="dateModified" content="2024-07-03T16:55:59+08:00" />
<meta itemprop="wordCount" content="3077"><meta itemprop="image" content="https://ccrysisa.github.io/logo.png" />
<meta itemprop="keywords" content="Sysprog,CSAPP," /><meta property="og:title" content="CS:APP 第 2 章重点提示和练习" />
<meta property="og:description" content="
千万不要小看数值系统，史上不少有名的 软体缺失案例 就因为开发者未能充分掌握相关议题，而导致莫大的伤害与损失。
" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ccrysisa.github.io/posts/csapp-ch2/" /><meta property="og:image" content="https://ccrysisa.github.io/logo.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-04-19T15:33:40+08:00" />
<meta property="article:modified_time" content="2024-07-03T16:55:59+08:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://ccrysisa.github.io/logo.png" /><meta name="twitter:title" content="CS:APP 第 2 章重点提示和练习"/>
<meta name="twitter:description" content="
千万不要小看数值系统，史上不少有名的 软体缺失案例 就因为开发者未能充分掌握相关议题，而导致莫大的伤害与损失。
"/>
<meta name="application-name" content="FixIt">
<meta name="apple-mobile-web-app-title" content="FixIt"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://ccrysisa.github.io/posts/csapp-ch2/" /><link rel="prev" href="https://ccrysisa.github.io/posts/linux-rbtree/" /><link rel="next" href="https://ccrysisa.github.io/posts/wsl2/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "CS:APP 第 2 章重点提示和练习",
    "inLanguage": "zh-CN",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https:\/\/ccrysisa.github.io\/posts\/csapp-ch2\/"
    },"genre": "posts","keywords": "Sysprog, CSAPP","wordcount":  3077 ,
    "url": "https:\/\/ccrysisa.github.io\/posts\/csapp-ch2\/","datePublished": "2024-04-19T15:33:40+08:00","dateModified": "2024-07-03T16:55:59+08:00","publisher": {
      "@type": "Organization",
      "name": ""},"author": {
        "@type": "Person",
        "name": "ccrysisa"
      },"description": ""
  }
  </script></head>
  <body data-header-desktop="sticky" data-header-mobile="auto"><script>(window.localStorage?.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('data-theme', 'dark');</script><div class="wrapper" data-page-style="normal"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/" title="KZnight&#39;s Blog"><img loading="lazy" src="/fixit.min.svg" alt="KZnight&#39;s Blog" data-title="KZnight&#39;s Blog" class="logo" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/><span class="header-title-text">KZnight&#39;s Blog</span></a><span class="header-subtitle"></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a
                class="menu-link"
                href="/posts/"
                
                
              ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> Posts</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/categories/"
                
                
              ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/tags/"
                
                
              ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/friends/"
                
                
              ><i class="fa-solid fa-user-group fa-fw fa-sm" aria-hidden="true"></i> Friends</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id="search-desktop">
            <input type="text" placeholder="搜索文章标题或内容……" id="search-input-desktop">
            <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
              <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
            </a>
            <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
              <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
            </a>
            <span class="search-button search-loading" id="search-loading-desktop">
              <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
            </span>
          </li><li class="menu-item theme-switch" title="切换主题">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/" title="KZnight&#39;s Blog"><img loading="lazy" src="/fixit.min.svg" alt="/fixit.min.svg" data-title="/fixit.min.svg" class="logo" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/><span class="header-title-text">KZnight&#39;s Blog</span></a><span class="header-subtitle"></span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li class="search-wrapper">
            <div class="search mobile" id="search-mobile">
              <input type="text" placeholder="搜索文章标题或内容……" id="search-input-mobile">
              <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
              </a>
              <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
              </a>
              <span class="search-button search-loading" id="search-loading-mobile">
                <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
              </span>
            </div>
            <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
              取消
            </a>
          </li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/posts/"
                  
                  
                ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> Posts</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/categories/"
                  
                  
                ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/tags/"
                  
                  
                ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/friends/"
                  
                  
                ><i class="fa-solid fa-user-group fa-fw fa-sm" aria-hidden="true"></i> Friends</a></li><li class="menu-item menu-system">
          <span class="menu-system-item theme-switch" title="切换主题"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></span></li>
      </ul>
    </nav>
  </div>
</header><div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
  </div>
  <div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
  </div><main class="container"><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label="合集"></aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span title="转载" class="icon-repost"><i class="fa-solid fa-share fa-fw" aria-hidden="true"></i></span><span>CS:APP 第 2 章重点提示和练习</span>
      </h1><p class="single-subtitle animate__animated animate__fadeIn">Representing and Manipulating Information</p></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><a href="https://github.com/ccrysisa" title="作者"target="_blank" rel="external nofollow noopener noreferrer author" class="author"><img loading="lazy" src="https://avatars.githubusercontent.com/u/133117003?s=400&amp;v=4" alt="ccrysisa" data-title="ccrysisa" class="avatar" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/>&nbsp;ccrysisa</a></span><span class="post-included-in">&nbsp;收录于 <a href="/categories/csapp/" class="post-category" title="分类 - CSAPP"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> CSAPP</a>&ensp;<a href="/categories/linux-kernel-internals/" class="post-category" title="分类 - Linux Kernel Internals"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> Linux Kernel Internals</a></span></div><div class="post-meta-line"><span title="发布于 2024-04-19 15:33:40"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden="true"></i><time datetime="2024-04-19">2024-04-19</time></span>&nbsp;<span title="更新于 2024-07-03 16:55:59"><i class="fa-regular fa-calendar-check fa-fw me-1" aria-hidden="true"></i><time datetime="2024-07-03">2024-07-03</time></span>&nbsp;<span title="3077 字"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>约 3100 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>预计阅读 7 分钟</span>&nbsp;</div>
    </div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>目录</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#数值系统">数值系统</a>
      <ul>
        <li><a href="#导读">导读</a></li>
        <li><a href="#bits-bytes--integers">Bits, Bytes &amp; Integers</a></li>
      </ul>
    </li>
    <li><a href="#浮点数">浮点数</a>
      <ul>
        <li><a href="#导读-1">导读</a></li>
        <li><a href="#floating-point">Floating Point</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
      </div><div class="content" id="content"><blockquote>
<p>千万不要小看数值系统，史上不少有名的 <a href="https://hackmd.io/@sysprog/software-failure"target="_blank" rel="external nofollow noopener noreferrer">软体缺失案例</a> 就因为开发者未能充分掌握相关议题，而导致莫大的伤害与损失。</p>
</blockquote>
<ul>
<li><a href="https://hackmd.io/@sysprog/CSAPP-ch2"target="_blank" rel="external nofollow noopener noreferrer">原文地址<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></li>
</ul>
<p>搭配 CMU: 15-213: Intro to Computer Systems: Schedule for Fall 2015</p>
<ul>
<li>可以在 <a href="https://www.cs.cmu.edu/afs/cs/academic/class/15213-f15/www/schedule.html"target="_blank" rel="external nofollow noopener noreferrer">这里</a> 找到相关的投影片和录影</li>
<li>B 站上有一个汉化版本的 <a href="https://www.bilibili.com/video/BV1iW411d7hd/"target="_blank" rel="external nofollow noopener noreferrer">录影</a></li>
</ul>
<h2 id="数值系统" class="heading-element">
  <a href="#%e6%95%b0%e5%80%bc%e7%b3%bb%e7%bb%9f" class="heading-mark"></a>数值系统</h2><h3 id="导读" class="heading-element">
  <a href="#%e5%af%bc%e8%af%bb" class="heading-mark"></a>导读</h3><ul>
<li><i class="fa-regular fa-check-square fa-fw" aria-hidden="true"></i> YouTube: <a href="https://www.youtube.com/watch?v=8J7sAYoG50A"target="_blank" rel="external nofollow noopener noreferrer">十进制，十二进制，六十进制从何而来？</a></li>
<li><i class="fa-regular fa-check-square fa-fw" aria-hidden="true"></i> YouTube: <a href="https://www.youtube.com/watch?v=jYQEkkwUBxQ"target="_blank" rel="external nofollow noopener noreferrer">老鼠和毒药问题怎么解？二进制和易经八卦有啥关系？</a></li>
<li><i class="fa-regular fa-check-square fa-fw" aria-hidden="true"></i> YouTube: <a href="https://www.youtube.com/watch?v=jYQEkkwUBxQ"target="_blank" rel="external nofollow noopener noreferrer">小精靈遊戲中的幽靈是怎麼追蹤人的? 鮮為人知的 bug</a></li>
<li><i class="fa-regular fa-check-square fa-fw" aria-hidden="true"></i> <a href="https://hackmd.io/@sysprog/binary-representation"target="_blank" rel="external nofollow noopener noreferrer">解读计算机编码</a></li>
<li><i class="fa-regular fa-check-square fa-fw" aria-hidden="true"></i> <a href="https://hackmd.io/@sysprog/c-undefined-behavior"target="_blank" rel="external nofollow noopener noreferrer">你所不知道的 C 语言: 未定义/未指定行为篇</a></li>
<li><i class="fa-regular fa-check-square fa-fw" aria-hidden="true"></i> <a href="https://hackmd.io/@sysprog/c-numerics"target="_blank" rel="external nofollow noopener noreferrer">你所不知道的 C 语言: 数值系统篇</a></li>
<li><i class="fa-regular fa-check-square fa-fw" aria-hidden="true"></i> <a href="https://hackmd.io/@sysprog/c-std-security"target="_blank" rel="external nofollow noopener noreferrer">基于 C 语言标准研究与系统程式安全议题</a></li>
<li>熟悉浮点数每个位的表示可以获得更大的最佳化空间
<ul>
<li><i class="fa-regular fa-square fa-fw" aria-hidden="true"></i> <a href="https://nfrechette.github.io/2019/05/08/sign_flip_optimization/"target="_blank" rel="external nofollow noopener noreferrer">Faster arithmetic by flipping signs</a></li>
<li><i class="fa-regular fa-square fa-fw" aria-hidden="true"></i> <a href="https://nfrechette.github.io/2019/10/22/float_xor_optimization/"target="_blank" rel="external nofollow noopener noreferrer">Faster floating point arithmetic with Exclusive OR</a></li>
</ul>
</li>
</ul>
<blockquote>
<p>看了上面的第 3 个影片后，对 pac-man 256 莫名感兴趣 &#x1f923;</p>
</blockquote>
<h3 id="bits-bytes--integers" class="heading-element">
  <a href="#bits-bytes--integers" class="heading-mark"></a>Bits, Bytes &amp; Integers</h3><div class="details admonition info open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-info-circle fa-fw" aria-hidden="true"></i>信息<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content"><a href="https://www.bilibili.com/video/BV1iW411d7hd?p=2"target="_blank" rel="external nofollow noopener noreferrer">第一部分录影</a> &#x2705;
/
<a href="https://www.cs.cmu.edu/afs/cs/academic/class/15213-f15/www/lectures/02-03-bits-ints.pdf"target="_blank" rel="external nofollow noopener noreferrer">投影片</a> &#x2705;
/
阅读章节: 2.1 &#x2705;</div>
    </div>
  </div>
<div class="details admonition info open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-info-circle fa-fw" aria-hidden="true"></i>信息<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content"><a href="https://www.bilibili.com/video/BV1iW411d7hd?p=3"target="_blank" rel="external nofollow noopener noreferrer">第二部分录影</a> &#x2705;
/
<a href="https://www.cs.cmu.edu/afs/cs/academic/class/15213-f15/www/lectures/02-03-bits-ints.pdf"target="_blank" rel="external nofollow noopener noreferrer">投影片</a> &#x2705;
/
阅读章节: 2.2-2.3 &#x2705;</div>
    </div>
  </div>
<a class="lightgallery" href="/images/c/02-03-bits-ints-41.png?size=large" data-thumbnail="/images/c/02-03-bits-ints-41.png?size=small" data-sub-html="<h2>/images/c/02-03-bits-ints-41.png</h2>"><img loading="lazy" src="/images/c/02-03-bits-ints-41.png" alt="/images/c/02-03-bits-ints-41.png" srcset="/images/c/02-03-bits-ints-41.png?size=small, /images/c/02-03-bits-ints-41.png?size=medium 1.5x, /images/c/02-03-bits-ints-41.png?size=large 2x" sizes="auto" data-title="/images/c/02-03-bits-ints-41.png" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></a>
<p>计算乘法至多需要多少位可以从无符号数和二补数的编码方式来思考。无符号数乘法最大值为 $2^{2w}-2^{2+1}+1$ 不超过 $2^{2w}$，依据无符号数编码方式至多需要 $2w$ bits 表示；二补数乘法最小值为 $-2^{2w-2}+2^{w-1}$，依据而二补数编码 MSB 表示值 $-2^{2w-2}$，所以 MSB 为第 $2w-2$ 位，至多需要 $2w-1$ bits 表示二补数乘法的最小值；二补数乘法最大值为 $2^{2w-2}$，因为 MSB 为符号位，所以 MSB 的右一位表示值 $2^{2w-2}$，即第 $2w-2$ 位，所以至多需要 $2w$ 位来表示该值 (因为还需要考虑一个符号位)。</p>
<ul>
<li>CS:APP 2.2.3 Two’s-Complement Encodings</li>
</ul>
<blockquote>
<p>Note the different position of apostrophes: two’s complement versus ones’ complement. The term “two’s complement” arises from the fact that for nonnegative x we compute a w-bit representation of −x as 2w − x (a single two.) The term “ones’ complement” comes from the property that we can compute −x in this notation as [111 . . . 1] − x (multiple ones).</p>
</blockquote>
<ul>
<li>CS:APP 2.2.6 Expanding the Bit Representation of a Number</li>
</ul>
<blockquote>
<p>This shows that, when converting from short to unsigned, the program first changes the size and then the type. That is, (unsigned) sx is equivalent to (unsigned) (int) sx, evaluating to 4,294,954,951, not (unsigned) (unsigned short) sx, which evaluates to 53,191. Indeed, this convention is required by the C standards.</p>
</blockquote>
<p>关于位扩展/裁剪与符号类型的关系这部分，可以参看我所写的笔记 <a href="/posts/c-std-security/">基于 C 语言标准研究与系统程序安全议题</a>，里面有根据规格书进行了探讨。</p>
<ul>
<li>CS:APP 2.3.1 Unsigned Addition</li>
</ul>
<blockquote>
<p>DERIVATION: Detecting overflow of unsigned addition</p>
<p>Observe that $x + y \geq x$, and hence if $s$ did not overflow, we will surely have $s \geq x$. On the other hand, if $s$ did overflow, we have $s = x + y − 2^w$. Given that $y &lt; 2^w$, we have $y − 2^w &lt; 0$, and hence $s = x + (y − 2^w ) &lt; x$.</p>
</blockquote>
<p>这个证明挺有趣的，对于加法 overflow 得出的结果 $s$ 的值必然比任意一个操作数 $x$ 和 $y$ 的值都小。</p>
<p>Practice Problem 2.31 利用了阿贝尔群的定义来说明二补数编码的可结合线，十分有趣。</p>
<p>Practice Problem 2.32 说明了二补数编码的一个需要特别注意的点：二补数编码构成的群是非对称的，$TMin$ 的加法逆元是其自身，其加法逆元后仍为 $TMin$。</p>
<ul>
<li>CS:APP 2.3.3 Two’s-Complement Negation</li>
</ul>
<blockquote>
<p>One technique for performing two’s-complement negation at the bit level is to complement the bits and then increment the result.</p>
</blockquote>
<blockquote>
<p>A second way to perform two’s-complement negation of a number $x$ is based on splitting the bit vector into two parts. Let $k$ be the position of the rightmost $1$, so the bit-level representation of $x$ has the form $[x_{w−1}, x_{w−2}, &hellip;, x_{k+1}, 1, 0, &hellip;, 0]$. (This is possible as long as $x \neq 0$.) The negation is then written in binary form as $[~x_{w−1}, ~x_{w−2}, &hellip;, ~x_{k+1}, 1, 0, &hellip;, 0]$. That is, we complement each bit to the left of bit position $k$.</p>
</blockquote>
<p>第二种解释在某些情况下十分有效，但这两种计算二补数的加法逆元的方法本质都来自 <a href="/posts/binary-representation/">解读计算机编码</a> 中的时钟模型。</p>
<ul>
<li>CSAPP: 2.3.5 Two’s-Complement Multiplication</li>
</ul>
<p>Practice Problem 2.35 使用了除法的定义证明了，使用除法来检测二补数乘法溢出的正确性 (如果不知道什么是除法的定义，可以看台湾大学齐震宇老师的数学新生营演讲录影，非常棒)。</p>
<p>与加法溢出的检测不太相同，乘法溢出的检测，不论无符号数还是二补数，都可以使用下面这种方法来检测:</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="c1">// x and y is N-bit wide
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int2N_t</span> <span class="n">s</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">return</span> <span class="n">s</span> <span class="o">==</span> <span class="p">(</span><span class="kt">intN_t</span><span class="p">)</span> <span class="n">s</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>如果是无符号数则使用相应的 <code>uint2N_t</code> 类型。Practice Problem 2.36 和 2.37 都使用到了这个技巧。</p>
<ul>
<li>CS:APP 2.3.6 Multiplying by Constants</li>
</ul>
<blockquote>
<p>principle: Unsigned multiplication by a power of 2<br>
principle: Two’s-complement multiplication by a power of 2</p>
</blockquote>
<p>这两个性质 (以及该性质的证明) 说明，无论是无符号数还是二补数，使用左移运算都可以达到与 2 的次方进行乘法运算的效果，甚至在溢出的情况下位模式也匹配。虽然如此，C 语言的编译器的处理可能并不会符合这里说明的等价性，因为无符号数和二补数对于溢出是不一样的。无符号数溢出在 C 语言规范并不是 UB，但二补数或者说有符号数溢出在 C 语言中是 UB，所以有时候使用有符号数分别进行，理论上结果等价的左移运算和乘法运算，得到的结果可能并不相同，特别是在启用了编译器最佳化的情况下 (因为编译器将依赖 UB 即溢出的有符号数乘法运算的行为移除了 &#x1f923;)。相关的说明请参考阅读 <a href="/posts/c-undefined-behavior/">C 语言: 未定义/未指定行为篇</a>。</p>
<ul>
<li>CS:APP 2.3.7 Dividing by Powers of 2</li>
</ul>
<blockquote>
<p>principle: Unsigned division by a power of 2</p>
<p>For C variables $x$ and $k$ with unsigned values $x$ and $k$, such that $0 \leq k &lt; w$, the  C expression $x &raquo; k$ yields the value $\lfloor x/2k \rfloor$</p>
</blockquote>
<p>使用算术右移获得的结果是 $\lfloor x/2k \rfloor$，这与整数除法获得的满足 <em>向 0 取整</em> 性质的结果在负数的情况下显然不同，需要进行相应的调节:</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">x</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">k</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="o">:</span> <span class="n">x</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">k</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Practice Problem 2.42 挺有意思的，我扩展了一下思路，将其改编为支援任意 2 的次方的除法:</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="c1">// x / (2^k)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="nf">div_2pK</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="mi">31</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="p">((</span><span class="o">-</span><span class="n">s</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="浮点数" class="heading-element">
  <a href="#%e6%b5%ae%e7%82%b9%e6%95%b0" class="heading-mark"></a>浮点数</h2><h3 id="导读-1" class="heading-element">
  <a href="#%e5%af%bc%e8%af%bb-1" class="heading-mark"></a>导读</h3><h3 id="floating-point" class="heading-element">
  <a href="#floating-point" class="heading-mark"></a>Floating Point</h3><div class="details admonition info open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-info-circle fa-fw" aria-hidden="true"></i>信息<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content"><a href="https://www.bilibili.com/video/BV1iW411d7hd?p=4"target="_blank" rel="external nofollow noopener noreferrer">录影</a> &#x2705;
/
<a href="https://www.cs.cmu.edu/afs/cs/academic/class/15213-f15/www/lectures/04-float.pdf"target="_blank" rel="external nofollow noopener noreferrer">投影片</a> &#x2705;
/
阅读章节: 2.4</div>
    </div>
  </div>
<p>浮点数名字的来源是指数部分 $E$ 可以进行调节进而影响小数点的位置，使得小数点在各种数字的表示时在浮动一般。</p>
<a class="lightgallery" href="/images/c/04-float-13.png?size=large" data-thumbnail="/images/c/04-float-13.png?size=small" data-sub-html="<h2>/images/c/04-float-13.png</h2>"><img loading="lazy" src="/images/c/04-float-13.png" alt="/images/c/04-float-13.png" srcset="/images/c/04-float-13.png?size=small, /images/c/04-float-13.png?size=medium 1.5x, /images/c/04-float-13.png?size=large 2x" sizes="auto" data-title="/images/c/04-float-13.png" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></a>
<p>此时让 Exponent value: E = 1 – Bias (instead of E = 0 – Bias) 可以使得这时的 Exponent value 和 exp 为 1 时 (其 Exponent value 也为 E = 1 – Bias) 相同，让浮点数可以在解决 0 的部分均分表示: $1.xxxx&hellip; \times 2^{1 - Bias}$, $0.xxxx&hellip; \times 2^{1 - Bias}$</p>
<a class="lightgallery" href="/images/c/04-float-15.png?size=large" data-thumbnail="/images/c/04-float-15.png?size=small" data-sub-html="<h2>/images/c/04-float-15.png</h2>"><img loading="lazy" src="/images/c/04-float-15.png" alt="/images/c/04-float-15.png" srcset="/images/c/04-float-15.png?size=small, /images/c/04-float-15.png?size=medium 1.5x, /images/c/04-float-15.png?size=large 2x" sizes="auto" data-title="/images/c/04-float-15.png" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></a>
<p>Normalized Encoding 时，指数每次 $+ 1$，就会使得可表示的浮点数之间数值的差距 $\times 2$ (因为正如前面所说的，浮点数浮动了小数点，使得用于表示小数位的编码位变少了)。注意下面的 $(n)$ 和 $(1)$ 只是表示 Significand 部分的编码，不代表数值 (因为这部分的数值是小数&hellip;)
$$
1.(n+1) \times 2^{K} - 1.(n) \times 2^{K} = (1) \times 2^{K} \\
1.(n+1) \times 2^{K + 1} - 1.(n) \times 2^{K + 1} = (1) \times 2^{K + 1} \\
(1) \times 2^{K + 1} = 2 \times ((1) \times 2^{K})
$$
显然两个浮点数之间的差距变为了原先的 2 倍了。</p>
<a class="lightgallery" href="/images/c/04-float-24.png?size=large" data-thumbnail="/images/c/04-float-24.png?size=small" data-sub-html="<h2>/images/c/04-float-24.png</h2>"><img loading="lazy" src="/images/c/04-float-24.png" alt="/images/c/04-float-24.png" srcset="/images/c/04-float-24.png?size=small, /images/c/04-float-24.png?size=medium 1.5x, /images/c/04-float-24.png?size=large 2x" sizes="auto" data-title="/images/c/04-float-24.png" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></a>
<p>Nearest Even 是用于决定，当前数值是舍入的两个数值的中间值时，向哪个数值进行舍入的策略。假设当前数值为 $1.2xxxx&hellip;$ (十进制)，需要舍入到 $0.1$ 的精度:</p>
<ul>
<li>当 $xxxx&hellip; &gt; 5000..0$ 时，即当前数值 $&gt; 1.25$，根据精度向上取整舍入到 $1.3$</li>
<li>当 $xxxx&hellip; &lt; 5000..0$ 时，即当前数值 $&lt; 1.25$，根据精度向下取整舍入到 $1.2$</li>
<li>当 $xxxx&hellip; = 5000..0$ 时，即当前数值 $= 1.25$，根据精度舍入到最近偶数 $1.2$</li>
</ul>
<p>类似的，假设当前数值为 $1.3xxxx&hellip;$，情况如下:</p>
<ul>
<li>当 $xxxx&hellip; &gt; 5000..0$ 时，即当前数值 $&gt; 1.35$，根据精度向上取整舍入到 $1.4$</li>
<li>当 $xxxx&hellip; &lt; 5000..0$ 时，即当前数值 $&lt; 1.35$，根据精度向下取整舍入到 $1.3$</li>
<li>当 $xxxx&hellip; = 5000..0$ 时，即当前数值 $= 1.35$，根据精度舍入到最近偶数 $1.4$</li>
</ul>
<hr>
<ul>
<li>CSAPP 2.4.1 Fractional Binary Numbers</li>
</ul>
<blockquote>
<p>Note that numbers of the form $0.11&hellip;1_2$ represent numbers just below 1.</p>
</blockquote>
<ul>
<li>CSAPP 2.4.2 IEEE Floating-Point Representation</li>
</ul>
<blockquote>
<p>Having the exponent value be $1 − Bias$ rather than simply $−Bias$ might seem counterintuitive. We will see shortly that it provides for smooth transition from denormalized to normalized values.</p>
</blockquote>
<p>除了让浮点数在靠近 0 的部分平滑均分表示之外，使用 biased form 还可以让浮点数的大小比较变得简单，只需使用 <strong>无符号编码</strong> 表示 exponent field 然后进行比较即可 (如果采取二补数编码，那么编码大的可能表示负数，大小比较起来更麻烦)。</p>
<blockquote>
<p>Denormalized numbers serve two purposes. First, they provide a way to represent numeric value 0</p>
</blockquote>
<blockquote>
<p>A second function of denormalized numbers is to represent numbers that are very close to 0.0.</p>
</blockquote>
<p>Denormalized 的作用一是表示 0，二是配合 Normalized 在靠近 0 的部分进行平滑均分表示</p>
<ul>
<li>CSAPP 2.4.3 Example Numbers</li>
</ul>
<blockquote>
<p>This is no accident—the IEEE format was designed so that floating-point numbers could be sorted using an integer sorting routine. A minor difficulty occurs when dealing with negative numbers, since they have a leading 1 and occur in descending order, but this can be overcome without requiring floating-point operations to perform comparisons</p>
</blockquote>
<p>可以直接使用整数排序来对浮点数进行排序，而无需使用浮点数操作来进行比较，这是 IEEE 754 精心设计的</p>
<blockquote>
<p>We can now see that the region of correlation corresponds to the low-order bits of the integer, stopping just before the most significant bit equal to 1 (this bit forms the implied leading 1), matching the high-order bits in the fraction part of the floating-point representation.</p>
</blockquote>
<p>浮点数和无符号数的编码之间的关系，其中无符号数的 MSB which equal 1 被忽略，因为浮点数在 Normalized 时会有一个隐含的 1</p>
<ul>
<li>CSAPP 2.4.4 Rounding</li>
</ul>
<blockquote>
<p>Rounding toward even numbers avoids this statistical bias in most real-life
situations. It will round upward about 50% of the time and round downward about
50% of the time.</p>
</blockquote>
<p>Round-to-even 可以让 round 后的数据在统计上的均值与原先数据的均值误差比较小</p></div><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod">
        <span title="更新于 2024-07-03 16:55:59">更新于 2024-07-03&nbsp;</span>
      </div></div><div class="post-info-line">
        <div class="post-info-md"><span><a href="/posts/csapp-ch2/index.md" title="阅读原始文档" class="link-to-markdown">阅读原始文档</a></span></div>
        <div class="post-info-share">
          <span><a href="javascript:void(0);" title="分享到 Twitter" data-sharer="twitter" data-url="https://ccrysisa.github.io/posts/csapp-ch2/" data-title="CS:APP 第 2 章重点提示和练习" data-hashtags="Sysprog,CSAPP"><i class="fa-brands fa-twitter fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Facebook" data-sharer="facebook" data-url="https://ccrysisa.github.io/posts/csapp-ch2/" data-hashtag="Sysprog"><i class="fa-brands fa-facebook-square fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 WhatsApp" data-sharer="whatsapp" data-url="https://ccrysisa.github.io/posts/csapp-ch2/" data-title="CS:APP 第 2 章重点提示和练习" data-web><i class="fa-brands fa-whatsapp fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Line" data-sharer="line" data-url="https://ccrysisa.github.io/posts/csapp-ch2/" data-title="CS:APP 第 2 章重点提示和练习"><i data-svg-src="/lib/simple-icons/icons/line.min.svg" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="https://ccrysisa.github.io/posts/csapp-ch2/" data-title="CS:APP 第 2 章重点提示和练习"><i class="fa-brands fa-weibo fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Myspace" data-sharer="myspace" data-url="https://ccrysisa.github.io/posts/csapp-ch2/" data-title="CS:APP 第 2 章重点提示和练习" data-description=""><i data-svg-src="/lib/simple-icons/icons/myspace.min.svg" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Blogger" data-sharer="blogger" data-url="https://ccrysisa.github.io/posts/csapp-ch2/" data-title="CS:APP 第 2 章重点提示和练习" data-description=""><i class="fa-brands fa-blogger fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Evernote" data-sharer="evernote" data-url="https://ccrysisa.github.io/posts/csapp-ch2/" data-title="CS:APP 第 2 章重点提示和练习"><i class="fa-brands fa-evernote fa-fw" aria-hidden="true"></i></a>
  </span>
        </div>
      </div></div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href="/tags/sysprog/" class="post-tag" title="标签 - Sysprog">Sysprog</a><a href="/tags/csapp/" class="post-tag" title="标签 - CSAPP">CSAPP</a></section>
    <section>
      <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
    </section>
  </div>

  <div class="post-nav"><a href="/posts/linux-rbtree/" class="post-nav-item" rel="prev" title="Linux 核心的红黑树"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>Linux 核心的红黑树</a>
      <a href="/posts/wsl2/" class="post-nav-item" rel="next" title="Windows 10 WSL2 Ubuntu 22.04 配置指南">Windows 10 WSL2 Ubuntu 22.04 配置指南<i class="fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article>

  <aside class="toc" id="toc-auto" aria-label="目录"><h2 class="toc-title">目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content" id="toc-content-auto"></div></aside></main><footer class="footer">
    <div class="footer-container"><div class="footer-line powered">由 <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreferrer" title="Hugo 0.121.1"><img class="hugo-icon" src="/images/hugo.min.svg" alt="Hugo logo" /> Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/hugo-fixit/FixIt" target="_blank" rel="external" title="FixIt v0.3.2-RC"><img class="fixit-icon" src="/images/fixit.min.svg" alt="FixIt logo" /> FixIt</a>
        </div><div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2021 - 2024</span><span class="author" itemprop="copyrightHolder">
              <a href="https://github.com/ccrysisa"target="_blank" rel="external nofollow noopener noreferrer">ccrysisa</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a></span></div><div class="footer-line visitor">
          <span id="busuanzi_container_site_uv" title='总访客数'><i class="fa-regular fa-user fa-fw" aria-hidden="true"></i>&nbsp;<span id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span><span id="busuanzi_container_site_pv" class="footer-divider" title='总访问量'><i class="fa-regular fa-eye fa-fw" aria-hidden="true"></i>&nbsp;<span id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span>
        </div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label="回到顶部"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric d-none">0%</span>
        </div></div><div id="mask"></div><noscript>
    <div class="noscript-warning">FixIt 主题在启用 JavaScript 的情况下效果最佳。</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/lightgallery/css/lightgallery-bundle.min.css"><link rel="preload" href="/lib/katex/katex.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/katex/katex.min.css"></noscript><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script src="/lib/autocomplete/autocomplete.min.js" defer></script><script src="/lib/lightgallery/lightgallery.min.js" defer></script><script src="/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js" defer></script><script src="/lib/lightgallery/plugins/zoom/lg-zoom.min.js" defer></script><script src="/lib/sharer/sharer.min.js" async defer></script><script src="/lib/katex/katex.min.js" defer></script><script src="/lib/katex/auto-render.min.js" defer></script><script src="/lib/katex/mhchem.min.js" defer></script><script src="/lib/cookieconsent/cookieconsent.min.js" defer></script><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async defer></script><script>window.config={"code":{"copyTitle":"复制到剪贴板","editLockTitle":"锁定可编辑代码块","editUnLockTitle":"解锁可编辑代码块","editable":true,"maxShownLines":30},"comment":{"enable":false},"cookieconsent":{"content":{"dismiss":"同意","link":"了解更多","message":"本网站使用 Cookies 来改善您的浏览体验。"},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"enablePWA":true,"lightgallery":true,"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50}};</script><script src="/js/theme.min.js" defer></script></body>
</html>
